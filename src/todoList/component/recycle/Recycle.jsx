import React from 'react';import Toolbar from './../common/ToolBar.jsx'import Mode from './RecycleCalculateMode.jsx'import './recycle.less'class Low extends React.Component {    constructor(props) {        super(props);        this.state = {            totalValue: 0, // 循环总压耗            showConfigPanel: false,            tabs: [                {label: '地面管汇压耗', code: 'pipe', value: 0,                    formula: '地面管汇摩阻系数*钻井液密度*（泵排量/100）^1.86*9.818'                },                {label: '钻杆内循环压耗', code: 'inner-cycle', value: 0,                    formula: '7628*塑性粘度^0.2*钻井液密度^0.8*泵排量^1.8*钻具长度/钻具内径^4.82'                },                {label: '加重钻杆内循环压耗', code: 'heavy-inner-cycle', value: 0,                    formula: '7628*塑性粘度^0.2*钻井液密度^0.8*泵排量^1.8*钻具长度/钻具内径^4.82'                },                {label: '钻铤内循环压耗', code: 'drill-inner-cycle', value: 0,                    formula: '7628*塑性粘度^0.2*钻井液密度^0.8*泵排量^1.8*钻具长度/钻具内径^4.82'                },                {label: '钻头压降', code: 'drill', value: 0,                    formula: '泵压 - 循环压耗'                },                {label: '钻杆环空压耗', code: 'body-cycle', value: 0,                    formula: '7628*塑性粘度^0.2*钻井液密度^0.8*泵排量^1.8*钻具长度/(井眼直径-钻具外径)^3/(井眼直径+钻具外径)^1.8'                },                {label: '加重钻杆环空压耗', code: 'heavy-body-cycle', value: 0,                    formula: '7628*塑性粘度^0.2*钻井液密度^0.8*泵排量^1.8*钻具长度/(井眼直径-钻具外径)^3/(井眼直径+钻具外径)^1.8'                },                {label: '钻铤环空压耗', code: 'drill-cycle', value: 0,                    formula: '7628*塑性粘度^0.2*钻井液密度^0.8*泵排量^1.8*钻具长度/(井眼直径-钻具外径)^3/(井眼直径+钻具外径)^1.8'                },                {label: '钻杆接箍环空压耗', code: 'body-cycle-patch', value: 0,                    formula: '7628*塑性粘度^0.2*钻井液密度^0.8*泵排量^1.8*钻具长度/(井眼直径-钻具外径)^3/(井眼直径+钻具外径)^1.8'                },                {label: '加重钻杆接箍环空压耗', code: 'heavy-body-cycle-patch', value: 0,                    formula: '7628*塑性粘度^0.2*钻井液密度^0.8*泵排量^1.8*钻具长度/(井眼直径-钻具外径)^3/(井眼直径+钻具外径)^1.8'                },            ],            singleItem: ''        };    }    getCalculator(code) {        switch (code) {            case 'pipe':                return <Mode.Pipe setValue={this.setValue.bind(this)} code={code}/>;            case 'inner-cycle':            case 'heavy-inner-cycle':            case 'drill-inner-cycle':                return <Mode.InnerCycle setValue={this.setValue.bind(this)} code={code}/>;            case 'drill':                return <Mode.Drill setValue={this.setValue.bind(this)} code={code}/>;            case 'body-cycle':            case 'heavy-body-cycle':            case 'drill-cycle':            case 'body-cycle-patch':            case 'heavy-body-cycle-patch':                return <Mode.BodyCycle setValue={this.setValue.bind(this)} code={code}/>;            default:                return null;        }    }    setValue(v, code) {        const tabs = Object.assign(this.state.tabs, []);        let tab = tabs.filter(i => {return i.code === code})[0];        tab.value = v;        this.setState({            tabs: tabs        })    }    showConfigPanel() {        this.setState({            showConfigPanel: true,            singleItem: ''        });    }    setFormula(formula) {        if(formula === undefined) return null;        if(typeof formula === 'string') {            return <p> {formula} </p>        } else {            let list = [];            formula.forEach((item, key) => {                list.push(<p key={key}> {item} </p>)            })            return list;        }    }    getConfigs() {        let list = [];        if(this.state.singleItem !== '') {            list.push(<li className='config-unit' key={this.state.singleItem.code}>                <div className='config-title'>                    <span className='config-label'> {this.state.singleItem.label} </span>                    <span className='config-formula'> {this.setFormula(this.state.singleItem.formula)} </span>                </div>                <div className='config-control'>                    {this.getCalculator(this.state.singleItem.code, this.state.singleItem.value)}                </div>            </li>)        } else {            let tabList = this.state.tabs;            tabList.forEach((item, key) => {                list.push(<div className='config-unit' key={key}>                    <div className='config-title'>                        <span className='config-label'> {item.label} </span>                        <span className='config-formula'> {this.setFormula(item.formula)} </span>                    </div>                    <div className='config-control'>                        {this.getCalculator(item.code)}                    </div>                </div>)            });        }        return list;    }    close() {        this.setState({            showConfigPanel: false        })    }    configPanel() {        if(this.state.showConfigPanel === true) {            return (<div className='configPanel'>                <div className='config' ref='configPanel'>                    <img className='close' src='./image/icon/close.png' onClick={this.close.bind(this)}/>                    {this.getConfigs()}                    <div className='btn-div'>                        <span className='confirm' onClick={this.confirm.bind(this)}>确定</span>                    </div>                </div>            </div>)        }        return null;    }    confirm() {        let totalValue = 0;        this.state.tabs.forEach(item => {            totalValue += item.value        });        this.setState({            showConfigPanel: false,            totalValue: totalValue.toFixed(2)        })    }    openSetting(item) {        this.setState({            showConfigPanel: true,            singleItem: item        })    }    renderPrams() {        let list = [];        this.state.tabs.forEach((item, key) => {            list.push(<div className='config-unit' key={key}  onClick={this.openSetting.bind(this, item)}>                <div className='config-title'>                    <span className='config-label'> {item.label} </span>                </div>                <div className='config-control'>                    <span className='config-input' data-code={item.code}> {item.value} </span>                </div>            </div>)        });        return list;    }    getStyledNum(value) {        let valStr = value.toString();        let list = [];        if(valStr === '0') {           valStr = '00000';        }        for(const i in valStr) {            list.push( <span className='block' key={i}> {valStr[i]} </span>)        }        return list;    }    setRecycleTotal() {        return <div className='num-div'>            {this.getStyledNum(this.state.totalValue)}        </div>    }    render() {        return <div className="recycle-bg">            {this.configPanel()}            <div className="open-config" onClick={this.showConfigPanel.bind(this)}>设置</div>            <img className="recycle-img" src={`./image/recycle/recycle.gif`}/>            <div className="param-div">                {this.renderPrams()}            </div>            <div className='recycle-div'>                <div className='title'>循环总压耗</div>                {this.setRecycleTotal()}            </div>            <Toolbar navigate={this.props.navigate && this.props.navigate.bind(this)}/>        </div>    }}export default Low;